"iSearch. Простой поиск по контактам" (c) google.ru

KittenDB iSearch предназначен для генерации поисковых подсказок. В качестве
исходных данных используется статистика поисковых запросов пользователей,
собираемая самим движком. В результате по префиксу запроса подсказываются
наиболее вероятные способы его завершения с учётом вероятностей совершения
опечаток. Также умеет угадывать, какой тип объекта ищет пользователь (друзей,
аудио и т.д.).

==Интерфейс==
Движок поддерживает memcached интерфейс и rpc-TL интерфейс. Описание
поддерживаемых rpc-TL запросов можно найти в схеме isearch/isearch.tl.

==Сбор статистики==
Статистика собирается при помощи отправки следующего запроса.

<code>set("stat{$uid},{$type}#{$cnt}", $text)</code>
<code>$uid</code> -- id пользователя, сделавшего запрос, не используется
<code>$type</code> -- тип поискового запроса, число от 1 до 255
<code>$cnt</code> -- количество найденных результатов
<code>$text</code> -- текст запроса в кодировке UTF-8


==Получение подсказок==

===Наиболее вероятные способы завершения запроса===
<code>get("hints({$text})")</code>
$text - поисковый запрос.
Результат будет иметь вид <hint_1>\n<hint_2>\n...\n<hint_n>
Подсказки упорядочены в порядке убывания релевантности, и их будет не более 5.

===Исправление опечатки в запросе===
<code>get("suggestion({$text})")</code>
$text - поисковый запрос.
Возвращается наиболее вероятный способ исправления опечатки или пустую строку.

===Получение наиболее частых запросов за последнее время===
<code>get("top{$cnt}")</code>
|$cnt| - максимальный размер результата.
Возвращается наиболее частые запросы с момента перезапуска движка среди
последнего миллиона запросов.
Если $cnt < 0, то игнорирует чёрный список.

===Получение наиболее популярных запросов за всё время===
<code>get("best{$cnt}")</code>
|$cnt| - максимальный размер результата.
Возвращается наиболее популярные запросы за всё время.
Если $cnt < 0, то игнорирует чёрный список.

== Нежелательные подсказки ==
В движок встроена поддержка "чёрного списка" фраз, наличие которых в поисковом
запросе не позволяет появляться им в подсказках. Для работы с "чёрным списком"
предназначены следующие функции:

===Добавление фразы в чёрный список===
<code>set("add_black_list", "{$text}")</code>
$text - добавляемая фраза.

===Удаление фразы из чёрного списка===
<code>set("delete_black_list", "{$text}")</code>
$text - удаляемая фраза.
Эффект от удаления фразы из чёрного списка будет виден только после
переиндексирования.

===Получение всех фраз из чёрного списка===
<code>get("black_list")</code>
Возвращает строку, содержащую фразы из чёрного списка, разделённые символом
табуляции '\t', в произвольном порядке.

===Форсированный пересчёт чёрного списка===
<code>get("black_list_force")</code>
Не возвращает ничего. Позволяет не дожидаясь переиндексирования пересчитать
чёрный список. Потенциально долгая операция, поэтому её не рекомендуется
использовать в production-коде.
